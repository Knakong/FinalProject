<div class="container" ng-app="app" ng-controller="ctrl">
  <div class="row min-vh-100 flex-column py-4">
      <div class="col-12 d-flex flex-column flex-grow-1">
          <div class="row flex-fill">
              <div class="col-md-3 bg-light py-3 rounded mr-md-1 mb-2">
                  <ul class="list-group sticky-top sticky-offset">
                      <button class="btn btn-block btn-outline-secondary my-1 text-uppercase" (click)="compose(composecontent)">Compose</button>
                      <div class="nav py-2 flex-md-column justify-content-center">
                          <h1 (click)="selected = 1" class="nav-link text-muted px-md-1" title="Messages">
                              <span class="fa fa-envelope-o fa-fw mr-md-1"></span>
                              <span class="d-none d-md-inline">Messages</span> <span class="badge badge-pill badge-primary" title="Unread" ng-show="unread.length>0" ng-bind="unread.length"></span>
                          </h1>
                          <h1 (click)="selected = 2" class="nav-link text-muted px-md-1" title="Deleted">
                              <span class="fa fa-trash fa-fw mr-md-1"></span>
                              <span class="d-none d-md-inline">Deleted</span>
                          </h1>
                      </div>
                  </ul>
              </div>
              <div class="col-md py-3 rounded shadow bg-white ml-md-n1 mb-2">
                  <!-- <div class="d-flex flex-sm-row flex-column py-1 mb-1">
                      <button type="button" class="btn btn-outline-secondary text-uppercase mr-sm-1 mr-none">
                          <div class="custom-control custom-checkbox">
                              <input type="checkbox" class="custom-control-input" id="checkAll">
                              <label class="custom-control-label text-nowrap" for="checkAll">All</label>
                          </div>
                      </button>
                      <button type="button" class="btn btn-outline-secondary text-uppercase mr-sm-auto mr-none">Move...</button>
                      <button type="button" class="btn btn-outline-secondary mr-sm-1 mr-none" data-target="#composeModal" data-toggle="modal"><i class="align-middle mb-1 material-icons">edit</i></button>
                      <button type="button" class="btn btn-outline-secondary text-uppercase dropdown-toggle" data-toggle="dropdown">More</button>
                      <div class="dropdown-menu dropdown-menu-right">
                          <a href="#" class="dropdown-item px-3">Trash</a>
                          <a href="#" class="dropdown-item px-3">Drafts</a>
                          <a href="#" class="dropdown-item px-3">Favorites</a>
                          <div class="dropdown-divider"></div>
                          <a href="#" class="dropdown-item px-3">New folder..</a>
                      </div>
                  </div> -->
                  <!-- messages list -->
                  <ul class="list-group py-2">
                    <div *ngIf="selected === 1">

                      <!-- single message (repeated) -->
                      <li *ngFor="let message of inbox" class="list-group-item d-block py-1">
                        <div class="row">
                          <div class="col-lg-3 p-2">
                            <div class="custom-control custom-checkbox">
                              <div class="custom-control-label text-nowrap" for="" (click)="open(viewcontent, message)">
                                <div class="col-6" *ngIf="message.dateSent"><p>Received: {{message.dateSent}}</p></div>
                                <div class="col-6" *ngIf="!message.dateSent"><p>Received: Unknown</p></div>
                                <div class="col-6"> From: {{message.sender.firstName + ' ' + message.sender.lastName}}</div>
                                </div>
                              </div>
                            </div>
                            <div class="col-lg py-2">
                              <div class="float-right text-right">
                                <span data-ng-class="{'font-weight-bold font-italic':!item.read}"></span>
                              </div>
                              <p class="lead mb-0">
                                <button class="btn btn-lg btn-outline-primary btnRight" (click)="open(content, message)">Reply</button>
                                <button class="btn btn-lg btn-outline-danger btnRight" (click)="delete(message.id)">Delete</button>
                              </p>
                            </div>
                          </div>
                        </li>
                      </div>

                      <div *ngIf="selected === 2">

                        <!-- deleted messages (repeated) -->
                        <li *ngFor="let message of deletedMessages" class="list-group-item d-block py-1">
                          <div class="row" (click)="view(viewcontent, message)">
                            <div class="col-lg-3 p-2">
                              <div class="custom-control text-nowrap">
                                <div>
                                  <div class="col-6" *ngIf="message.dateSent"><p>Received: {{message.dateSent}}</p></div>
                                 <div class="col-6" *ngIf="!message.dateSent"><p>Received: Unknown</p></div>
                                 <div class="col-6"> From: {{message.sender.firstName + ' ' + message.sender.lastName}}</div>
                               </div>
                               </div>
                              </div>
                              <div class="col-lg py-2">
                                <div class="float-right text-right">
                                  <span data-ng-class="{'font-weight-bold font-italic':!item.read}"></span>
                                </div>
                              </div>
                            </div>
                          </li>

                        </div>
                        </ul>

                        <!-- Reply Modal -->
                  <ng-template #content let-modal>
                    <div class="modal-header">
                      <h4 class="modal-title" id="modal-basic-title">From: {{viewedMessage.sender.username}}</h4>
                      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
                    </div>
                    <div class="modal-header">
                      <small class="text-uppercase text-muted">Sent: {{viewedMessage.dateSent}}</small>
                      <div>
                          <h4 class="modal-title"></h4>
                      </div>
                  </div>
                    <div class="modal-body">
                      <table>
                        <thead></thead>
                        <tbody>
                          <tr>
                            <td>
                              <p>{{viewedMessage.contents}}</p>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <form>
                        <div class="mb-3">
                          <label for="reply">Reply</label>
                          <div class="input-group">
                            <textarea id="reply" class="form-control" name="reply" [(ngModel)]="createdMessage.contents"
                            ></textarea>
                          </div>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <app-create-message [receiverId]="viewedMessage.sender.id" [message]="createdMessage"
                      (click)="createdMessage.contents = ''"></app-create-message>
                    </div>
                  </ng-template>
                  <!-- End Reply Modal -->

                  <!-- Compose Modal -->
                  <ng-template #composecontent let-modal>
                    <div class="modal-header">
                      <h4 class="modal-title" id="modal-basic-content" aria-label="modal-basic-content">Compose New Message</h4>
                      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
                    </div>
                    <div class="modal-header">
                      <small class="text-uppercase text-muted">Send To: </small>
                      <select [(ngModel)]="receiverUsername">
                        <option [value]="user.username" *ngFor="let user of followedUsers">{{user.username}}</option>
                        </select>
                      <div>
                          <h4 class="modal-title"></h4>
                      </div>
                  </div>
                    <div class="modal-body">
                      <form>
                        <div class="mb-3">
                          <label for="compose">Compose</label>
                          <div class="input-group">
                            <textarea id="compose" class="form-control" name="compose"[(ngModel)]="createdMessage.contents" ></textarea>
                          </div>
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <app-create-message [message]="createdMessage" [receiverUsername]="receiverUsername"
                      (click)="close()"></app-create-message>
                    </div>
                  </ng-template>
                  <!-- End Compose Modal -->

                  <!-- View Modal -->
                  <ng-template #viewcontent let-modal>
                    <div class="modal-header">
                      <h4 class="modal-title" id="modal-basic-content" aria-label="modal-basic-content">View Message</h4>
                      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
                    </div>
                    <div class="modal-header">
                      <small class="text-uppercase text-muted">Sent By: </small>
                      <p>
                        {{viewedMessage.sender.username}}
                      </p>
                      <small class="text-uppercase text-muted">Received On: </small>
                      <p *ngIf="viewedMessage.dateSent">
                        {{viewedMessage.dateSent}}
                      </p>
                      <p *ngIf="!viewedMessage.dateSent">
                        Unknown
                      </p>
                      <div>
                        <h4 class="modal-title"></h4>
                      </div>
                    </div>
                    <div class="modal-body">
                      <p><strong>From: </strong>{{viewedMessage.sender.firstName + ' ' + viewedMessage.sender.lastName}}</p>
                      <form>
                        <div class="mb-3">
                          <label for="compose">Message</label>
                          <div class="input-group">
                            <textarea id="compose" class="form-control" name="compose"[(ngModel)]="viewedMessage.contents" ></textarea>
                          </div>
                        </div>
                      </form>
                    </div>
                  </ng-template>
                  <!-- End View Modal -->
              </div>
          </div>
      </div>
  </div>
</div>
